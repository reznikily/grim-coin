# Grim Coin - Decentralized Wallet Network

Децентрализованная сеть кошельков с распределенной синхронизацией и блокировкой транзакций.

## Возможности

- ✅ Автоматическое обнаружение сетевых адаптеров
- ✅ Гарантированная доставка сообщений с подтверждением (ACK)
- ✅ Распределенная блокировка для транзакций
- ✅ Синхронизация таблицы состояний между всеми узлами
- ✅ Контроллер с веб-дашбордом в реальном времени
- ✅ WebSocket обновления без перезагрузки страницы

## Установка

```bash
# Установка зависимостей
make deps

# Сборка
make build
```

## Запуск

### Контроллер

```bash
make run-controller
```

Контроллер:
- Прослушивает сообщения от кошельков
- Синхронизирует таблицу состояний
- Предоставляет веб-дашборд на порту 8081
- WebSocket сервер на порту 8080

### Кошелек

```bash
make run-wallet
```

При первом запуске кошелек:
1. Предложит выбрать сетевой адаптер
2. Запросит ID (имя) кошелька
3. Сохранит профиль в `.wallet_profile.json`
4. Отправит HELLO всем узлам в сети

## Команды кошелька

```bash
send <id> <amount>  # Отправить монеты другому кошельку
balance             # Показать свой баланс
table               # Показать таблицу сети
exit                # Выход
```

## Архитектура

### Протокол сообщений

- `HELLO` - Объявление о присутствии в сети
- `HELLO_ACK` - Подтверждение получения HELLO
- `TABLE_SYNC` - Синхронизация таблицы состояний
- `TABLE_ACK` - Подтверждение получения таблицы
- `TRANSACTION` - Транзакция между кошельками
- `TX_ACK` - Подтверждение получения транзакции
- `LOCK_REQUEST` - Запрос распределенной блокировки
- `LOCK_GRANT` - Предоставление блокировки
- `LOCK_RELEASE` - Снятие блокировки

### Гарантированная доставка

Все критичные сообщения (HELLO, TABLE_SYNC, TRANSACTION) отправляются с механизмом подтверждения:
1. Отправка сообщения
2. Ожидание ACK с таймаутом 2 секунды
3. Повтор до 5 раз при неудаче

### Распределенная блокировка

При транзакции:
1. Кошелек запрашивает блокировку у всех узлов
2. Каждый узел отвечает LOCK_GRANT
3. После получения всех подтверждений транзакция выполняется
4. Новая таблица рассылается всем с гарантией доставки
5. Блокировка снимается

### Веб-дашборд

Доступен по адресу `http://<controller-ip>:8081/dashboard.html`

Показывает в реальном времени:
- Количество активных кошельков
- Общее количество монет в сети
- Версию таблицы состояний
- Список всех кошельков с балансами
- Статус подключения

## Структура проекта

```
grim-coin/
├── cmd/
│   ├── controller/
│   │   └── main.go          # Точка входа контроллера
│   └── wallet/
│       └── main.go          # Точка входа кошелька
├── types.go                 # Типы данных и сообщений
├── network.go              # Сетевой уровень и UDP коммуникация
├── controller.go           # Логика контроллера
├── wallet.go               # Логика кошелька
├── Makefile                # Команды сборки и запуска
├── go.mod                  # Зависимости Go
└── README.md              # Документация
```

## Порты

- `9999` - UDP broadcast для обмена сообщениями
- `8080` - WebSocket сервер контроллера
- `8081` - HTTP сервер дашборда

## Очистка

```bash
make clean  # Удалить бинарники и профиль кошелька
```
