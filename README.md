# GrimCoin

Распределенная криптовалютная система с автоматическим обнаружением узлов в локальной сети.

## Быстрый старт

### 1. Запуск контроллера

```bash
./controller
```

Контроллер автоматически:
- Определит свой IP в локальной сети
- Запустит WebSocket серверы на портах 8000 (кошельки) и 8080 (наблюдатели)
- Начнет рассылать UDP broadcast анонсы для обнаружения

### 2. Запуск кошелька

```bash
./wallet -config configs/wallet.yaml
```

При первом запуске:
- Вам будет предложено ввести имя кошелька
- Автоматически сгенерируется уникальный ID
- Кошелек начнет сканировать сеть и найдет контроллер и другие кошельки

### 3. Использование кошелька

Доступные команды:
- `send <id_получателя> <сумма>` - отправить монеты
- `balance` - показать текущий баланс и версию
- `exit` - выйти

Пример:
```
> balance
Balance: 10, Version: 0

> send 12345 2
Transaction initiated

> balance
Balance: 8, Version: 1
```

### 4. Веб-наблюдатель

Откройте `web/observer.html` в браузере и укажите адрес контроллера (например, `ws://192.168.1.100:8080/ws`)

## Архитектура

### Порты
- **7999/UDP** - обнаружение узлов (broadcast)
- **8000/TCP** - контроллер ⟷ кошельки (WebSocket)
- **8080/TCP** - контроллер ⟷ наблюдатель (WebSocket)
- **9000/TCP** - P2P между кошельками (WebSocket)

### Автоматическое обнаружение

Система использует UDP broadcast для автоматического обнаружения узлов в локальной сети:
1. Каждый узел отправляет анонсы каждые 3 секунды
2. Анонсы содержат тип узла (контроллер/кошелек), ID, имя и порты
3. Broadcast адрес вычисляется автоматически для вашей подсети

### Транзакции (этап 2)

1. Кошелек запрашивает эксклюзивную блокировку у контроллера
2. При получении блокировки отправляет транзакцию себе и всем пирам
3. Каждый узел проверяет версию и баланс перед применением
4. После подтверждения всех узлов отправляется `commit_notice`
5. Контроллер собирает состояния и проверяет согласованность

## Сборка

```bash
go build -o controller ./cmd/controller
go build -o wallet ./cmd/wallet
```

## Требования

- Go 1.21+
- Локальная сеть (WiFi/Ethernet)
- Открытые порты: 7999/UDP, 8000/TCP, 8080/TCP, 9000/TCP

## Устранение проблем

### Кошелек не находит контроллер
1. Убедитесь, что оба устройства в одной подсети
2. Проверьте firewall (должен разрешать UDP 7999 и TCP 8000, 9000)
3. Запустите контроллер с флагом `-v` для verbose логирования

### Транзакция не проходит
1. Проверьте баланс: `balance`
2. Убедитесь, что все кошельки онлайн
3. Проверьте логи на наличие ошибок версий или блокировок
